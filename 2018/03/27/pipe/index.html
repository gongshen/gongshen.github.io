<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="keyword"  content="">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        pipe - undefined
        
    </title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/aircloud.css">
    <link rel="stylesheet" href="/css/gitment.css">
    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_pl6z7sid89qkt9.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>
</head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i>  </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar">
            <img src="/" />
        </div>
        <div class="name">
            <i>John Doe</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li >
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>HOME</span>
                </a>
            </li>
            <li >
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>TAGS</span>
                </a>
            </li>
            <li >
                <a href="/archives">
                    <i class="iconfont icon-guidang2"></i>
                    <span>ARCHIVES</span>
                </a>
            </li>
            <li >
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>ABOUT</span>
                </a>
            </li>
            
            <li>
                <a id="search">
                    <i class="iconfont icon-sousuo1"></i>
                    <span>SEARCH</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1、匿名管道"><span class="toc-text">1、匿名管道</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2、命名管道（文件管道）和内存管道"><span class="toc-text">2、命名管道（文件管道）和内存管道</span></a></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input"/>
            <span id="begin-search">search</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>
        <div class="index-about-mobile">
            <i>  </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        pipe
    </div>

    <div class="post-meta">
        <span class="attr">Post：<span>2018-03-27 23:41:34</span></span>
        
        </span>
        <span class="attr">Visit：<span id="busuanzi_value_page_pv"></span>
</span>
</span>
    </div>
    <div class="post-content ">
        <h3 id="1、匿名管道"><a href="#1、匿名管道" class="headerlink" title="1、匿名管道"></a>1、匿名管道</h3><p>package main</p>
<p>import (<br>    “os/exec”<br>    “fmt”<br>    “os”<br>    “bufio”<br>    “bytes”<br>    “io”<br>)<br>func runCmd() {<br>    var useBufIO=false<br>    cmd0 := exec.Command(“echo”, “-n”, “My first command comes from golang.”)</p>
<pre><code>// 设置一个输出通道
stdout0, err := cmd0.StdoutPipe()

if err != nil {
    fmt.Printf(&quot;Error:Counld&apos;t obtain the stdout pipe from command NO.0:%s\n&quot;, err)
    return
}
// Start
if err := cmd0.Start(); err != nil {
    fmt.Printf(&quot;Error:The command NO.0 can not be startup:%s\n&quot;, err)
    return
}

// 调用read方法获取命令
var output0 = make([]byte, 30)

if !useBufIO {
    var outputBuf0 bytes.Buffer
    for {
        tempOutput0 := make([]byte, 5)
        n, err := stdout0.Read(tempOutput0)
        if err != nil {
            if err == io.EOF {
                break
            } else {
                fmt.Printf(&quot;Error:Couldn&apos;t read data from the pipe:%s\n&quot;, err)
                os.Exit(1)
            }
        }
        if n &gt; 0 {
            outputBuf0.Write(tempOutput0[:n])
        }
    }
    fmt.Printf(&quot;%s\n&quot;, outputBuf0.String())
} else {
    // 缓存读取器
    var isPrefix bool
    for {
        outputBuf0 := bufio.NewReaderSize(stdout0, 5)
        output0, isPrefix, err = outputBuf0.ReadLine()
        if err != nil {
            fmt.Printf(&quot;Error:Couldn&apos;t read data from the pipe:%s\n&quot;, err)
            os.Exit(1)
        }
        fmt.Printf(&quot;%s&quot;, string(output0))
        if isPrefix == false {
            break
        }
    }
}
</code></pre><p>}</p>
<p>// 通过管道将输出值作为另一个命令的输入<br>func runCmdPipe(){<br>    var outputBuf1 bytes.Buffer<br>    var outputBuf2 bytes.Buffer<br>    cmd1:=exec.Command(“ps”,”aux”)<br>    cmd2:=exec.Command(“grep”,”apipe”)<br>    //将所有的输出内容都记录到这里<br>    cmd1.Stdout=&amp;outputBuf1<br>    if err:=cmd1.Start();err!=nil{<br>        fmt.Printf(“Error:The frist command can not be startup:%s\n”,err)<br>        return<br>    }<br>    //cmd1结束运行之前，wait()调用会一直阻塞<br>    if err:=cmd1.Wait();err!=nil{<br>        fmt.Printf(“Error:Can’t wait for the first command:%s\n”,err)<br>        return<br>    }</p>
<pre><code>cmd2.Stdin=&amp;outputBuf1
cmd2.Stdout=&amp;outputBuf2
if err:=cmd2.Start();err!=nil{
    fmt.Printf(&quot;Error:The second command can not be startup:%s\n&quot;,err)
    return
}
if err:=cmd2.Wait();err!=nil{
    fmt.Printf(&quot;Error:Cant&apos;t wait for the second command:%s\n&quot;,err)
    return
}
fmt.Printf(&quot;%s\n&quot;,outputBuf2.String())
</code></pre><p>}</p>
<p>func main(){<br>    runCmd()<br>    fmt.Println()<br>    runCmdPipe()<br>}</p>
<h3 id="2、命名管道（文件管道）和内存管道"><a href="#2、命名管道（文件管道）和内存管道" class="headerlink" title="2、命名管道（文件管道）和内存管道"></a>2、命名管道（文件管道）和内存管道</h3><p>package main</p>
<p>import (<br>    “os”<br>    “fmt”<br>    “time”<br>    “io”<br>)</p>
<p>// 基于文件的管道，其中一端未绪前阻塞另一端的进程<br>func fileBasePipe() {<br>    reader,writer,err:=os.Pipe()<br>    if err!=nil{<br>        fmt.Printf(“Error:Create named pipe failed:%s\n”,err)<br>        return<br>    }<br>    go func() {<br>        outPut:=make([]byte,100)<br>        n,err:=reader.Read(outPut)<br>        if err!=nil{<br>            fmt.Printf(“Error:Could’t read data from the named pipe: %s\n”,err)<br>        }<br>        fmt.Printf(“Readed %d byte(s)[based pipe]\n”,n)<br>        fmt.Println(string(outPut))<br>    }()<br>    inPut:=make([]byte,26)<br>    for i:=65;i&lt;90;i++{<br>        inPut[i-65]=byte(i)<br>    }<br>    n,err:=writer.Write(inPut)<br>    if err!=nil{<br>        fmt.Printf(“Error: Couldn’t write data to the named pipe: %s\n”,err)<br>    }<br>    fmt.Printf(“Written %d byte(s).[based pipe]\n”,n)<br>    time.Sleep(200*time.Millisecond)<br>}</p>
<p>// 基于内存的有原子性操作的管道<br>func memoryBasePipe() {<br>    reader, writer := io.Pipe()<br>    go func() {<br>        outPut := make([]byte, 100)<br>        n,err := reader.Read(outPut)<br>        if err != nil {<br>            fmt.Printf(“Error:Read fatal: %s\n”, err)<br>        }<br>        fmt.Printf(“Readed %d byte(s)[based pipe]\n”, n)<br>        fmt.Println(string(outPut))<br>    }()<br>    inPut:=make([]byte,26)<br>    for i:=65;i&lt;90;i++{<br>        inPut[i-65]=byte(i)<br>    }<br>    n, err := writer.Write(inPut)<br>    if err != nil {<br>        fmt.Printf(“Error:Write fatal: %s\n”, err)<br>    }<br>    fmt.Printf(“Written %d byte(s).[based pipe]\n”, n)<br>    time.Sleep(200*time.Millisecond)<br>}</p>
<p>func main() {<br>    fileBasePipe()<br>    fmt.Println()<br>    memoryBasePipe()<br>}</p>

        
        <div id="comment-container">
        </div>
    </div>
</div>
    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        

        

        

    </ul>
    
    <p>
        <span id="busuanzi_container_site_pv">
            <span id="busuanzi_value_site_pv"></span>PV
        </span>
        <span id="busuanzi_container_site_uv">
            <span id="busuanzi_value_site_uv"></span>UV
        </span>
        Created By <a href="https://hexo.io/">Hexo</a>  Theme <a href="https://github.com/aircloud/hexo-theme-aircloud">AirCloud</a></p>
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "search.json"
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="/js/index.js"></script>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

</html>
